<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>湖南绿茵科技环保</title>
<script src="https://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script src="http://libs.baidu.com/jquery/1.9.1/jquery.js"></script>
<style>
body{
    background-color: #F0F8FF;
}
.prompt{
    margin:0 auto;border:1px solid #000;width:500px;height:300px;margin-bottom: 60px;font-weight: bold;font-size: large;
}

.title_1{
    margin:0 auto;
    margin-bottom: 20px;
    text-align:center;
    font-style: oblique;
    font-weight: bold;
    color:red;
}
.title_2{
    margin:0 auto;
    margin-bottom: 20px;
    text-align:center;
    font-style: oblique;
    font-weight: bold;
    color:red;
}
.content {
	width:456px;
	margin:0 auto;
	text-align:center;
	font-weight:800;
    font-size: 20px;
}
.rank {
    width:500px;
    margin:0 auto;
    margin-top: 40px;
    text-align:center;
    font-weight:800;
    font-size: 20px;
}
.kuai {
	width:150px;
	height:150px;
	float:left;
	line-height:150px;
	border:1px solid #666;
}
.button {
	width:456px;
	margin:0 auto;
	text-align:center;
}
.choujiang {
	border:none;
	color:#fff;
	background-color:#5cb85c;
	border-radius:4px;
	font-size:20px;
	color:#fff;
	padding:5px 20px;
	margin-top:20px;
	cursor:pointer;
    width: 400px;
    height: 100px;
}
.choujiang:hover {
	background-color:red;
}
</style>
</head>
<body>
<h1 class="title_1" id="title_1">湖南绿茵环保科技开业大酬宾</h1>
<h1 class="title_2" id="title_2" style="display: none">恭喜！恭喜！中奖啦，请填写您的信息</h1>
<div class="prompt" style="display: none" id="form_good">
    <form onsubmit="return false" action="##" method="post">
        <input type="hidden" name="good" id="good" value="">
        姓名:<br>
        <input type="text" style="width: 499px;height: 50px" id="user" name="user">
        <br>
        手机号:<br>
        <input type="text" style="width: 499px;height: 50px" id="phone" name="phone">
        <br><br>
        <button  style="font-size:2em; width: 100%;height: 100%;background-color: red" type="button" onclick="my_good()">提交</button>
    </form>
</div>
<div class="content" id="content">

</div>
<div class="button" id="b_choujiang">
    <button type="button" class="choujiang">抽奖</button>
</div>
<div class="rank">
<table border="1">
    <span>中奖名单<span><br>
    <pre id="span_1" style="color: red"></pre>
    <pre id="span_2" style="color: red"></pre>
    <pre id="span_3" style="color: red"></pre>
    <pre id="span_4" style="color: red"></pre>
    <pre id="span_5" style="color: red"></pre>
    <pre id="span_6" style="color: red"></pre>
    <pre id="span_7" style="color: red"></pre>
    <pre id="span_8" style="color: red"></pre>

</table>
</div>
<script>
//请在此段代码前引用jq,否则代码无效
$(document).ready(function() {
    var name = ['免费治理', '免费检测', '特惠检测', '特惠治理', '空气清新剂1瓶', '活性炭包', '500元治理抵扣券', '800元治理抵扣券', '谢谢参与']
    for (var i = 1; i <= name.length; i++) {
        $(".content").append('<div id="' + i + '" class="kuai">' + name[i - 1] + '</div>');
    }
    $('.choujiang').on('click', function() {
        $(this).attr("disabled", true); //点击按钮后,按钮进入不可编辑状态
        var sum = name.length;
        var le = 3 //设置滚动多轮
        var hh = sum * le;
        var y = 1;
        var x = hh;
        var times = 12; //调节滚动速度
        var rand = parseInt(Math.random() * (x - y + 1) + y); //获取随机数
        var i = Math.ceil(rand / sum); //向上取整
        for (var i = i; i < le; i++) {
            rand = rand + sum
        }
        time(1, rand, times, sum, times) //点击按钮后触发time事件
    });

    $.ajax({
        type:"GET", //请求方式
        url:"http://ly.com/initial.php", //请求的url地址
        data:{"good":1}, //参数值
        dataType:'json',

        success:function(result){
            if(result.code == 200){//button_choujiang
                var str_info_2 = '';
                var str_info_3 = '';
                var str_info_4 = '';
                var str_info_5 = '';
                var str_info_6 = '';
                var str_info_7 = '';
                var str_info_8 = '';

                if(result.info_2 != ''){
                    var arr = []

                    for (let i in result.info_2) {
                        arr.push(result.info_2[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_2+=str1+" ";
                    }
                }

                if(result.info_3 != ''){
                    var arr = []

                    for (let i in result.info_3) {
                        arr.push(result.info_3[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_3+=str1+" ";
                    }
                }

                if(result.info_4 != ''){
                    var arr = []

                    for (let i in result.info_4) {
                        arr.push(result.info_4[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_4+=str1+" ";
                    }
                }

                if(result.info_5 != ''){
                    var arr = []

                    for (let i in result.info_5) {
                        arr.push(result.info_5[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_5+=str1+" ";
                    }
                }
                if(result.info_6 != ''){
                    var arr = []

                    for (let i in result.info_6) {
                        arr.push(result.info_6[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_6+=str1+" ";
                    }
                }
                if(result.info_7 != ''){
                    var arr = []

                    for (let i in result.info_7) {
                        arr.push(result.info_7[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_7+=str1+" ";
                    }
                }
                if(result.info_8 != ''){
                    var arr = []

                    for (let i in result.info_8) {
                        arr.push(result.info_8[i]); //

                    }
                    for(var i =0 ;i<arr.length;i++){
                        var str  = arr[i].toString();
                        var str1 =  str.replace(",",":")
                        str_info_8+=str1+" ";
                    }
                }
                $("#span_1").text("免费治理 【任远：15201692468】");
                $("#span_2").text("免费检测【 " + str_info_2 + "】");
                $("#span_3").text("特惠检测【" + str_info_3+ "】");
                $("#span_4").text("特惠治理【 " + str_info_4+ "】");
                $("#span_5").text("空气清新剂1瓶【 " + str_info_5+ "】");
                $("#span_6").text("活性炭包【 "+ str_info_6+ "】");
                $("#span_7").text("500元治理抵扣【 "+ str_info_7+ "】");
                $("#span_8").text("800元治理抵扣【 "+ str_info_8+ "】");
             }

        },
        error:function(){
           // alert("提交失败");window.location.reload();
        }

    });



});


function my_good()
{
    var good = $("#good").val();
    var user = $("#user").val();
    var phone = $("#phone").val();

    $.ajax({
        type:"POST", //请求方式
        url:"http://ly.com/ins.php", //请求的url地址
        data:{"good":good,"user":user,"phone":phone}, //参数值
        dataType:'json',

        success:function(result){
            if(result.code == 200){//button_choujiang
                alert("提交成功")
                window.location.reload();
            }else{
                alert(result.msg)
               // window.location.reload();
            }

        },
        error:function(){
            alert("提交失败");window.location.reload();
        }

    });
}

function time(shu, sums, tie, sum, tis) { //倒计时
    var tie = tie + tis //滚动速度

    setTimeout(function() {
        if (shu <= sums) {
            $('.kuai').css({
                'background-color': '',
                'color': ''
            }) //清除css
            $('#' + shu + '').css({
                'background-color': 'aqua',
                'color': '#fff'
            }) //添加css样式
            if (shu == sum) {
                sums = sums - shu
                shu = 0;
            }
            shu++
            text(shu, sums, tie, sum, tis)
        } else {
            $('.choujiang').attr("disabled", false); //抽奖完毕,按钮重新进入可编辑状态
            $.ajax({
                type:"POST", //请求方式
                url:"http://ly.com/index.php", //请求的url地址
                data:{"id":sums}, //参数值
                dataType:'json',
                crossDomain: true,    //一定要加
                success:function(result){
                    if(result.code == 200){//button_choujiang
                        $("#good").val(sums);
                        $("#form_good").css('display','block');
                        $("#content").css('display','none');
                        $("#b_choujiang").css('display','none');
                       // $("#title_2").textContent('恭喜！恭喜！中奖啦，请填写您的信息1');
                        $("#title_2").css('display','block');
                        $("#title_2").text('恭喜！恭喜！'+result['msg_bak']+',请填写您的信息');
                        $("#title_1").css('display','none');
                    }else{
                        alert(result.msg_bak);
                        window.location.reload();
                    }

                 },
                error:function(){
                    alert("失败");
                }

            });
        }
    }, tie);
}

function text(shu, sums, tie, sum, tis) {
    time(shu, sums, tie, sum, tis) //执行time事件
}
</script>

</body>
</html>
